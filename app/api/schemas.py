"""Схемы API.

Этот модуль содержит Pydantic-модели, которые используются:
- как контракт ответов эндпоинтов (response_model),
- как входные payload-модели для команд (например, яркость/питание),
- как единый слой валидации для UI/бота/клиентов.

Почему это отдельно:
- схемы не смешиваются с бизнес-логикой (доменом) и транспортом (роутами),
- изменения контракта проще отслеживать по одному месту,
- типизация клиентов (например, Telegram-бота) становится очевиднее.

Принципы:
- яркость всегда нормализована в диапазон 0..1 (float),
- валидация диапазонов делается на границе API через Field(...),
- модели названы с суффиксами In/Out, чтобы отличать вход/выход.
"""

from __future__ import annotations

from pydantic import BaseModel, Field


class DeviceInfoOut(BaseModel):
    """Метаданные устройства для выдачи наружу.

Важно: этот объект не раскрывает внутренние детали реализации (GPIO-пин,
частоты PWM и т.п.), он нужен клиентам для построения UI и диагностики.
"""

    device_id: str
    device_type: str


class LedStateOut(BaseModel):
    """Текущее состояние LED-устройства, возвращаемое клиентам.

brightness:
- 0.0 означает "выключено" (или яркость на нуле),
- 1.0 означает максимальную яркость.
"""

    is_on: bool
    brightness: float = Field(ge=0.0, le=1.0)


class SetPowerIn(BaseModel):
    """Команда включения/выключения для LED-устройства.

Поле is_on отражает желаемое состояние питания, а не "тумблер" — то есть
повторная отправка is_on=true должна быть идемпотентна по смыслу.
"""

    is_on: bool


class SetBrightnessIn(BaseModel):
    """Команда установки яркости для LED-устройства.

brightness ожидается в нормализованном виде 0..1.
UI может работать в процентах 0..100, но в API отправляется именно 0..1,
чтобы контракт был одинаковым для любых клиентов.
"""

    brightness: float = Field(ge=0.0, le=1.0)


class StatusOut(BaseModel):
    """Сводный статус сервиса для диагностики.

Это не "healthcheck" (он проще), а диагностический endpoint:
- uptime,
- какой GPIO-бэкенд активен (mock/rpi),
- какие устройства зарегистрированы,
- их текущие состояния.
"""

    service: str
    uptime_s: float
    gpio_backend: str
    devices: list[DeviceInfoOut]
    led_states: dict[str, LedStateOut] = Field(default_factory=dict)
